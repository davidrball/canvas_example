<!DOCTYPE html>
<html>
    
    <center><img id="html5" src="testing_distortion_truecolor.png" width="400"/ align="middle"></center>
    <div class ="blurb">
      <p> <font size = "20">
	Want to see what your face would look like if we put a black hole in front of it like in the image above?  Upload a selfie and find out!  Also check out our snapchat filter at SNAPCHAT FILTER DETAILS</font>
      </p>
    </div>




<!--<label>Image File:</label><br/>-->

<input type="file" id="imageLoader" name="imageLoader"/>
<canvas id="imageCanvas"></canvas>
<canvas id="transformedCanvas"></canvas>
<script>

var imageLoader = document.getElementById('imageLoader');
    imageLoader.addEventListener('change', handleImage, false);

var canvas = document.getElementById('imageCanvas');
var ctx = canvas.getContext('2d');

var canvas2 = document.getElementById('transformedCanvas');
var ctx2 = canvas2.getContext('2d');

function handleImage(e){
    var reader = new FileReader();
    reader.onload = function(event){
        var img = new Image();
        img.onload = function(){
            canvas.width = img.width; 
            canvas.height = img.height;
            ctx.drawImage(img,0,0);
            var imgData = ctx.getImageData(0,0,canvas.width, canvas.height);
	        var newimgData = ctx2.createImageData(imgData);                
            canvas2.width = img.width;
            canvas2.height = img.height;

            var radius=100;
            var xhlf = canvas2.width/2;
            var yhlf = canvas2.height/2;
            console.log(newimgData.data.length);
            console.log(canvas2.width);
            console.log(canvas2.height);

            var i;
            for (i=0;i<newimgData.data.length;i+=4){
                var truei = Math.floor(i/4);
                var tmpy = Math.floor(truei / canvas2.width);
                var tmpx = truei % canvas2.width;
                var deltax = tmpx-xhlf;
                var deltay = tmpy-yhlf;
                var myr2 = deltax*deltax + deltay*deltay;
                if (myr2>radius*radius){
                    newimgData.data[i]=imgData.data[i];
                    newimgData.data[i+1]=imgData.data[i+1];
                    newimgData.data[i+2]=imgData.data[i+2];
                    newimgData.data[i+3]=imgData.data[i+3];
                }
                else{
                    newimgData.data[i]=0;
                    newimgData.data[i+1]=0;
                    newimgData.data[i+2]=0;
                    newimgData.data[i+3]=255;
                }


}


            ctx2.putImageData(newimgData,0,0);
        }
        img.src = event.target.result;
    }
    reader.readAsDataURL(e.target.files[0]);     
}
</script>



</html>
